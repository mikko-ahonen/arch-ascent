{% extends "base.html" %}
{% load component_tags %}

{% block title %}Vision{% endblock %}

{% block content %}
<div class="d-flex justify-content-end align-items-center gap-2 mb-3">
    <button
        class="btn btn-sm btn-primary"
        id="new-vision-btn"
        hx-get="{% url 'vision:vision-form' %}"
        hx-target="#dialog"
    >New Vision</button>
</div>

<div class="card">
    <div class="card-header py-2">
        <div class="d-flex justify-content-between align-items-center">
            <small class="text-muted">Visions</small>
            <small class="text-muted">{{ visions|length }}</small>
        </div>
    </div>
    <div class="card-body p-0">
        <div id="vision-list">
            {% component "vision_list" visions=visions %}{% endcomponent %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check if coming from scope with pre-selected projects
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('from_scope') === '1') {
        const projectIds = sessionStorage.getItem('scopeProjectIds');
        if (projectIds) {
            // Auto-open the vision form
            const btn = document.getElementById('new-vision-btn');
            if (btn) {
                // Trigger HTMX request
                htmx.trigger(btn, 'click');
            }
        }
    }
});
</script>
{% endblock %}
